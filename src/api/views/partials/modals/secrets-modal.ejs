<% if (!instance) { %>
    <% /* no modal if no instance */ %>
<% } else { %>
    <div class="modal fade" id="secretsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Set secrets</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <div id="secretsResult" class="mb-3"></div>

                    <form
                            hx-put="/api/trade-instance/<%= instance.id %>/secrets"
                            hx-target="#secretsResult"
                            hx-swap="innerHTML"
                            hx-headers='{"Accept":"text/html"}'
                            hx-on::after-request="
              if (event.detail.successful) {
                setTimeout(() => {
                  const el = document.getElementById('secretsModal');
                  const modal = bootstrap.Modal.getInstance(el);
                  document.querySelector('#secretsModal input[name=private_key]').value = '';
                  modal?.hide();
                }, 2000);
              }
            "
                    >
                        <div class="mb-3">
                            <label class="form-label">Wallet address</label>
                            <input
                                    name="wallet_address"
                                    class="form-control"
                                    autocomplete="off"
                                    value="<%= instance.wallet_address ?? '' %>"
                                    placeholder="0x..."
                            />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Private key</label>
                            <input
                                    name="private_key"
                                    class="form-control"
                                    autocomplete="off"
                                    value=""
                                    placeholder="Paste your private key"
                            />
                            <div class="form-text">
                                For safety, the private key field is not prefilled.
                            </div>
                        </div>

                        <div class="d-flex justify-content-end gap-2">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Save
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
<% } %>
